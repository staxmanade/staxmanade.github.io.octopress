---
layout: post
title: "i4o & Silverlight Unit Tests (A little more work than the i4o library)"
date: 2008-12-07T22:37:00-08:00
comments: false
categories:
 - Silverlight
 - i4o
---

<div class='post'>
<p>Follow up to my post on <a href="http://staxmanade.blogspot.com/2008/12/i4o-with-silverlight-compiles-first-try.html" target="_blank">i4o &amp; Silverlight (compiles first try)</a>...</p>  <p>&#160;</p>  <p>I took a stab at porting the i4o unit tests to <a href="http://silverlight.com/" target="_blank">Silverlight</a> which was quite a bit more work than I initially expected.</p>  <p>After creating a <a href="http://code.msdn.microsoft.com/silverlightut" target="_blank">Silverlight Unit Test</a> project and linking the original test files into the Silverlight project, I compiled...</p>  <ul>   <li>First the VB using statement wasn't even needed, so I removed that. <span style="color: #0000ff">using</span> Microsoft.VisualBasic;       <br /></li>    <li>Second there is no System.Diagnostics.Stopwatch() class in Silverlight, so I basically implemented a quick one using DateTime to get the unit tests to compile in Silverlight. Here's the class, except the Frequency property has been commented out (didn't spend time to figure how to make that correct, or what is correct???) </li> </ul>  <pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Stopwatch<br />{<br />	<span style="color: #0000ff">private</span> DateTime _StartUtcDateTime;<br />	<span style="color: #0000ff">private</span> DateTime? _EndUtcDateTime;<br />	<span style="color: #0000ff">private</span> <span style="color: #0000ff">bool</span> _IsRunning = <span style="color: #0000ff">false</span>;<br /><br />	<span style="color: #008000">//public static readonly long Frequency { get { throw new NotImplementedException(); } }</span><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">readonly</span> <span style="color: #0000ff">bool</span> IsHighResolution = <span style="color: #0000ff">false</span>;<br />	<span style="color: #0000ff">public</span> Stopwatch()<br />	{}<br /><br />	<span style="color: #0000ff">public</span> TimeSpan Elapsed<br />	{<br />		<span style="color: #0000ff">get</span><br />		{<br />			<span style="color: #0000ff">if</span> (_EndUtcDateTime.HasValue)<br />			{<br />				<span style="color: #0000ff">return</span> <span style="color: #0000ff">new</span> TimeSpan(_EndUtcDateTime.Value.Ticks - _StartUtcDateTime.Ticks);<br />			}<br />			<span style="color: #0000ff">else</span><br />			{<br />				<span style="color: #0000ff">return</span> <span style="color: #0000ff">new</span> TimeSpan(DateTime.UtcNow.Ticks - _StartUtcDateTime.Ticks);<br />			}<br />		}<br />	}<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">long</span> ElapsedMilliseconds { <span style="color: #0000ff">get</span> { <span style="color: #0000ff">return</span> Elapsed.Milliseconds; } }<br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">long</span> ElapsedTicks { <span style="color: #0000ff">get</span> { <span style="color: #0000ff">return</span> Elapsed.Ticks; } }<br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> IsRunning { <span style="color: #0000ff">get</span> { <span style="color: #0000ff">return</span> _IsRunning; } }<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">long</span> GetTimestamp()<br />	{<br />		<span style="color: #0000ff">return</span> DateTime.Now.Ticks;<br />	}<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> Reset()<br />	{<br />		_EndUtcDateTime = <span style="color: #0000ff">null</span>;<br />		_StartUtcDateTime = DateTime.UtcNow;<br />	}<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> Start()<br />	{<br />		_EndUtcDateTime = <span style="color: #0000ff">null</span>;<br />		_IsRunning = <span style="color: #0000ff">true</span>;<br />		<span style="color: #0000ff">this</span>._StartUtcDateTime = DateTime.UtcNow;<br />	}<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> Stopwatch StartNew()<br />	{<br />		var w = <span style="color: #0000ff">new</span> Stopwatch();<br />		w.Start();<br />		<span style="color: #0000ff">return</span> w;<br />	}<br /><br />	<span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> Stop()<br />	{<br />		_EndUtcDateTime = DateTime.UtcNow;<br />		_IsRunning = <span style="color: #0000ff">false</span>;<br />	}<br />}</pre><br /><br /><p>The only other issue that came up was some of the Stopwatch dependent tests happened so fast that they would fail intermittently... the quick hack/solution for this was to up the iteration count of whatever they were testing.</p><br /><p>After all the above taking care of all the above issues, I was able to get the unit tests to pass. </p><br /><p><a href="http://lh4.ggpht.com/_L6Vw0x_R3iw/STzAmsr9cuI/AAAAAAAAACU/ImLvor4RNNQ/s1600-h/image%5B4%5D.png"><img style="border-top-width: 0px; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="372" alt="image" src="http://lh4.ggpht.com/_L6Vw0x_R3iw/STzAm05AF3I/AAAAAAAAACY/HKajhxLiWtk/image_thumb%5B2%5D.png?imgmax=800" width="367" border="0" /></a></p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Tiaan</div>
<div class='content'>
You might also want to look at my implementation of the <A HREF="http://blog.tiaan.com/link/2009/02/03/stopwatch-silverlight" REL="nofollow">Stopwatch for Silverlight</A>, which supports resuming.</div>
</div>
<div class='comment'>
<div class='author'>Tiaan</div>
<div class='content'>
For the Frequency property's implementation, you probably just need to return the System.TimeSpan.TicksPerSecond value.</div>
</div>
</div>
