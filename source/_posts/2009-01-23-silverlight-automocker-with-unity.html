---
layout: post
title: "Silverlight AutoMocker with Unity container and Moq"
date: 2009-01-23T23:14:00-08:00
comments: false
categories:
 - Testing
 - Silverlight
---

<div class='post'>
<p>A couple weeks back I threw out a <a href="/2009/01/silverlight-moq-automocker-teaser" target="_blank">Teaser about a Silverlight AutoMocker</a>... Here's the follow up I promised.</p>  <p><strong><u> UPDATE: Moq 3.0 released with full Silverlight support </u></strong><a href="http://moq.me/get"><strong><u>http://moq.me/get </u></strong></a></p>  <p>I've been working on this off and on for a while now, and finally decided to sit down and finalize (at least this version) of both Moq for Silverlight and an AutoMocking container backed by the <a href="http://codeplex.com/Unity" target="_blank">Unity IoC</a> from Microsoft.</p>  <p>This isn't by any means &quot;Official&quot;, but probably not far from what will be coming out when it's done... </p>  <p>Below are the necessary steps (I can come up with) to get an official version of Moq.</p>  <ol>   <li>We need an &quot;Official&quot; build of the Castle.DynamicProxy2 dependency      <ol>       <li>Create NAnt build scripts (Jonathon Rossi said he'd try to work on it this weekend 1/23) Thank God! It tried porting the NAnt build to Silverlight and each of the 3 times I got so lost I gave up... :( </li>        <li>Fix the Castle.Core-Silverlight build (some changes have occurred to the main without being pushed to the Silverlight Version) </li>        <li>Create an official binaries of          <ol>           <li>Castle.Core </li>            <li>Castle.DynamicProxy </li>         </ol>       </li>     </ol>   </li>    <li>Port Moq to Silverlight      <ol>       <li>I supplied a patch to Daniel a while ago, but he said he wouldn't include it until #1 above. </li>     </ol>   </li> </ol>  <p>But until the official versions become available, here are what I have so far!!!</p>  <p><strong>UPDATE</strong>: oops, realized I posted the files below as .7z. You can download and install the free open source zip utility here <a href="http://www.7-zip.org/">http://www.7-zip.org/</a></p>  <p>&#160;</p>  <p>This contains the Moq, Moq-Contrib (w/unity AutoMocker) source    <br /><iframe style="border-right: #dde5e9 1px solid; padding-right: 0px; border-top: #dde5e9 1px solid; padding-left: 0px; padding-bottom: 0px; margin: 3px; border-left: #dde5e9 1px solid; width: 240px; padding-top: 0px; border-bottom: #dde5e9 1px solid; height: 66px; background-color: #ffffff" marginwidth="0" marginheight="0" src="http://cid-c0f357e4555270e7.skydrive.live.com/embedrowdetail.aspx/Public/src-MoqAndMoqContribForSilverlight.7z" frameborder="0" scrolling="no"></iframe></p>  <p>This contains all the binaries you need to run Moq...    <br /><iframe style="border-right: #dde5e9 1px solid; padding-right: 0px; border-top: #dde5e9 1px solid; padding-left: 0px; padding-bottom: 0px; margin: 3px; border-left: #dde5e9 1px solid; width: 240px; padding-top: 0px; border-bottom: #dde5e9 1px solid; height: 66px; background-color: #ffffff" marginwidth="0" marginheight="0" src="http://cid-c0f357e4555270e7.skydrive.live.com/embedrowdetail.aspx/Public/bin-MoqAndMoqContribForSilverlight.7z" frameborder="0" scrolling="no"></iframe></p>  <p>&#160;</p>  <p>Please keep in mind I'm by no means an IoC pro and the whole AutoMocker was a one afternoon attempt at throwing one together that I could use in Silverlight. It's very basic, but seems to support most of what I need for now.</p>  <p>Could an AutoMocking container backed by Moq and Unity be a project that the community needs?</p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
@Mark<br /><br />I&#39;ve been disconnected from the castle dynamic proxy for quite a while. (Last I knew Mr. Rossi was going to get it into the build process) If that&#39;s true, building from src would be your best bet. If it&#39;s not possible through the NAnt script, then, the way I originally did it, was opening up the Silverlight project in VS and building that way... (I think you have to run the NAnt build at least once for it to setup the AssemblyInfo.cs stuff before you try to vs build)<br /><br />Hope this helps. (sorry I don&#39;t have more info than this)</div>
</div>
<div class='comment'>
<div class='author'>Mark</div>
<div class='content'>
Re: the error with generic constraints - I created a test for this and it is fixed on the main build see here: http://support.castleproject.org/projects/DYNPROXY/issues/view/DYNPROXY-ISSUE-92<br /><br />I&#39;m not sure how to get this into a silverlight version - there doesn&#39;t seem to be a Silverlight build. Can you help?<br /><br />Thanks<br /><br />Mark</div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Any chance you could send an example test?</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Hi Jason, <BR/>This is really cool...thanks!<BR/><BR/>I thought you might want to know about an error I received. When mocking an interface containing generic parameter constraints, I receive the error... <BR/><BR/>System.BadImageFormatException: An attempt was made to load a program with an incorrect format.<BR/><BR/>...when running the test. <BR/><BR/>Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
@Adam - There's two things you can do.<BR/><BR/>1. Moq-contrib at google code already has an AutoMocker that uses the AutoFac IoC.<BR/><BR/>or<BR/><BR/>2. Take my source, recompile the AutoMocker in .net (make sure to get the correct full-framework dependencies)<BR/><BR/>Hope that helps...</div>
</div>
<div class='comment'>
<div class='author'>Adam</div>
<div class='content'>
I would really like an Automocker for the *WPF* side of things.</div>
</div>
</div>
