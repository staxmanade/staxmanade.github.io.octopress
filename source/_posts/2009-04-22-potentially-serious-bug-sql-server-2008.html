---
layout: post
title: "Potentially SERIOUS bug. -- SQL Server 2008 Management Studio"
date: 2009-04-22T12:44:00-07:00
comments: false
alias: /blog/1048041102670828854
---

<div class='post'>
<p>&#160;</p>  <h5><strong>UPDATE</strong>: <a href="http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=434465">Microsoft’s acknowledged the bug</a>… </h5>  <p>We had a scenario (several weeks back) where a co-worker was connecting/changing connection between different sql servers and ended up in a state where the Microsoft SQL Server Management Studio said he was connected to one server however when executing queries it was connected to a different server.</p>  <p>This issue has been in the back of my mind ever since as a “what if this happens when connected to a production database and not my local dev box” issue. <strong>(WARNING: SERIOUS DATA CORRUPTION MAY OCCUR, when connected to the wrong server unknowingly)</strong>     <br />NOTE: Luckily, we recently gave read-only rights to our dev AD user accounts so this situation couldn’t happen. I know, I know, “why didn’t we have that from the beginning?”……It happens, anyway…</p>  <p>Well, today I had the issue when working between my Dev box and our Test server and it took another developer (Thanks <a href="http://blogs.vertigo.com/personal/KeithC/Blog/default.aspx">Keith Craig</a> from <a href="http://vertigo.com/">Vertigo Software</a>) to help me figure out the data I was looking at was not actually the data from the server I thought I was connected to.</p>  <h4>Screenshot of the problem:</h4>  <p><a href="http://lh3.ggpht.com/_L6Vw0x_R3iw/Se9znnFVA2I/AAAAAAAAAGg/IKSZ0G0a2uc/s1600-h/image%5B80%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_L6Vw0x_R3iw/Se9zn6m79WI/AAAAAAAAAGk/g3MFRsXosPM/image_thumb%5B44%5D.png?imgmax=800" width="583" height="176" /></a> </p>  <h4>How to get into that state…</h4>  <ol>   <li>Start with a query connected to a remote database.      <br /><strong>NOTE: The two servers in red are the same. (Yay, we’re in a good state)        <br /></strong><a href="http://lh4.ggpht.com/_L6Vw0x_R3iw/Se9zoFlU4xI/AAAAAAAAAGo/1h9D7imn7IE/s1600-h/image%5B67%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh4.ggpht.com/_L6Vw0x_R3iw/Se9zoePT_NI/AAAAAAAAAGs/5MbzroqWfc4/image_thumb%5B37%5D.png?imgmax=800" width="587" height="181" /></a> </li>    <li>Click the “New Query” button to open a new query window.      <br /><a href="http://lh3.ggpht.com/_L6Vw0x_R3iw/Se9zolT1-MI/AAAAAAAAAGw/c2nVVkPNhnM/s1600-h/image%5B11%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_L6Vw0x_R3iw/Se9zokyQjEI/AAAAAAAAAG0/-_ac3kcfC-Y/image_thumb%5B5%5D.png?imgmax=800" width="267" height="104" /></a> </li>    <li>Right click in the new empty query window, while it’s loading, and you (might) get the option to Connect. (if you’re fast enough)      <br /><strong>NOTE: This happens if you right click before the window finishes initializing it’s connection to the original server (in this case the remote database server). Usually this dialog gives you the “Change Connection” option when connected, but if you’re fast enough you can get the “Connect” option and the “Change Connection” will be disabled.        <br /></strong>&#160;<a href="http://lh4.ggpht.com/_L6Vw0x_R3iw/Se9zpFCI01I/AAAAAAAAAG4/N2RyXe126XI/s1600-h/image%5B72%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh3.ggpht.com/_L6Vw0x_R3iw/Se9zpWnCC9I/AAAAAAAAAG8/MkhCXu6Z-Z4/image_thumb%5B40%5D.png?imgmax=800" width="655" height="234" /></a> </li>    <li>Click “Connect” and choose to the new desired server. In this case I’m going to connect to (local)      <br /><a href="http://lh4.ggpht.com/_L6Vw0x_R3iw/Se9zpmM2FXI/AAAAAAAAAHA/t47nPurq3t4/s1600-h/image%5B20%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh6.ggpht.com/_L6Vw0x_R3iw/Se9zp48_DyI/AAAAAAAAAHE/_93Vimltrl0/image_thumb%5B10%5D.png?imgmax=800" width="411" height="156" /></a> </li>    <li>That’s it, I’m now connected to the original server <strong><u>FILES</u></strong>, even though it says I'm connected to the server entered in the dialog above <strong><u>(local)</u></strong>.       <br />&#160;&#160; <a href="http://lh6.ggpht.com/_L6Vw0x_R3iw/Se9zqBTmYBI/AAAAAAAAAHI/_vxrTOlW_6s/s1600-h/image%5B84%5D.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://lh5.ggpht.com/_L6Vw0x_R3iw/Se9zqaGoMcI/AAAAAAAAAHM/vupnhlDVQhw/image_thumb%5B46%5D.png?imgmax=800" width="583" height="176" /></a> </li> </ol>  <p></p>  <p></p>  <p></p>  <p></p>  <p></p>  <p></p>  <p>&#160;</p>  <h4>Current Work Around to Avoid this Problem:</h4>  <h1 align="center"><u><em>PATIENCE</em></u></h1>  <p>To avoid the issue, wait till the query window has time to finish it’s initialization and has connect to the previous server. Then you can Right-Click –&gt; Connection –&gt; Change Connection…</p>  <p>&#160;</p>  <p>Hope this helps someone else… because, like I stated earlier… <strong>(WARNING: SERIOUS DATA CORRUPTION MAY OCCUR, when connected to the wrong server unknowingly)</strong></p>  </div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jason Jarrett</div>
<div class='content'>
I don&#39;t have any sql server builds that I can test anymore. This was an old post and I&#39;ve since forgotten all about it... Looks like Microsoft closed it as &quot;won&#39;t fix&quot; http://connect.microsoft.com/SQLServer/feedback/details/434465/management-studio-can-display-connection-to-wrong-server</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Hi Jason,<br /><br />I tried to reproduce this bug in SSMS 2008 (10.0.5500.0), and the Connect option is disabled while the new query window is initializing. Looks like it&#39;s fixed to me.<br /><br />Please can you verify.<br />Thanks<br />Andy</div>
</div>
</div>
