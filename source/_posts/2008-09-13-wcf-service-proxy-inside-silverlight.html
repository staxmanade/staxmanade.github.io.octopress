---
layout: post
title: "WCF Service Proxy inside Silverlight with a generic type"
date: 2008-09-13T18:32:00-07:00
comments: false
categories:
 - Silverlight
---

<div class='post'>
We've implemented a silverlight 2 business application communicating through WCF and I just had to blog about something I found possible in .net in general...<br /><br />On the server side we have a very simple generic object used to communicate validation issues back to our Silverlight client when a web service method is called. Here's the basic interface.<br /><br />public interface IValidatedResult&lt;T&gt;<br />{<br />    T Result { get; set; }<br />    List&lt;string&gt; ValidationIssues { get; set; }<br />}<br /><br />Now if you had a method that exposed this generic result object through your web service...<br /><br /><br />public ValidatedResult&lt;long&gt; StringLength(string param1)<br />{<br />    return new ValidatedResult&lt;long&gt;(param1.Length);<br />}<br /><br /><br />Now if you to to the silverlight project tell Visual Studio to generate a proxy for you (against the service you just created) it will give you a proxy with an object that is not generic. You end up with some autogenerated code that looks more like...<br /><br /><br />public partial class ValidatedResultOflong : object, System.ComponentModel.INotifyPropertyChanged<br />{<br /><br />    private long ResultField;<br /><br />    private System.Collections.ObjectModel.ObservableCollection&lt;string&gt; ValidationIssuesField;<br /><br />    [System.Runtime.Serialization.DataMemberAttribute()]<br />    public long Result<br />    {<br />        get<br />        {<br />            return this.ResultField;<br />        }<br />        set<br />        {<br />            if ((this.ResultField.Equals(value) != true))<br />            {<br />                this.ResultField = value;<br />                this.RaisePropertyChanged("Result");<br />            }<br />        }<br />    }<br /><br />    [System.Runtime.Serialization.DataMemberAttribute()]<br />    public System.Collections.ObjectModel.ObservableCollection&lt;string&gt; ValidationIssues<br />    {<br />        get<br />        {<br />            return this.ValidationIssuesField;<br />        }<br />        set<br />        {<br />            if ((object.ReferenceEquals(this.ValidationIssuesField, value) != true))<br />            {<br />                this.ValidationIssuesField = value;<br />                this.RaisePropertyChanged("ValidationIssues");<br />            }<br />        }<br />    }<br /><br />    // stripped out the INotifyPropertyChanged goo<br />}<br /><br /><br />Notice the non generic type ValidatedResultOflong  that was generated? This non generic object is great and all except when you want to do some generic processing on these objects. For things like error handling, validation handling... if we had to create different handling methods for all of these different objects, that could prove to be laborious...<br /><br />Say I wanted to write an extension method to do some generic processing on all objects that are a ValidatedResult of T... Unfortunately there is no common signature we can key off of to write this method with the proxy code generated by V.S.<br /><br />Then I thought I would try something... Can you have a partial class in one area which contains a common property, in this case each contains a "Result" and a "ValidationIssues" property and another partial class in a different location that declares it implements an interface which defines that "Result" and "ValidationIssues" property... and would that compile?<br /><br />So I wrote my first test...<br /><br />Here is our auto generated partial class simulated...<br /><br />public partial class Foo<br />{<br />    public bool Result { get; set; }<br />}<br /><br /><br />I then wrote a generic result of T to define the object has a Result property.<br /><br />public interface IResult&lt;T&gt;<br />{<br />    T Result { get; set; }<br />}<br /><br /><br />And now the specific implementation with a long Result type.<br /><br />public partial class Foo : IResult&lt;long&gt; {}<br /><br /><br />After putting those three structures together I hit Build in VS and to my surprise (at first, but now it makes total sense) it compiled... This was great news. This meant I could create a generic processor for my wcf objects in silverlight... I'll show how on the silverlight side below...<br /><br />I defined the validated result contract as follows...<br />public interface IResultProperty&lt;T&gt;<br />{<br />    T Result { get; }<br />}<br /><br />public interface IValidatedResult&lt;T&gt; : IResultProperty&lt;T&gt;<br />{<br />    List&lt;string&gt; ValidationIssues { get; set; }<br />}<br /><br /><br />This meant I could quickly create partial class stubs for each of the wcf generated objects that looked like... ValidatedResultOf{object} and would define to the compiler that all these objects truly implemented the ValidationIssues and Result property.<br /><br />Here's an example of the partial class for the ValidatedResultOflong <br /><br />public partial class ValidatedResultOflong : IValidatedResult&lt;long&gt; { }<br /><br />With that in place, this meant I could create some generic handling methods for all of my objects that now implement IValidatedResult&lt;T&gt;...<br /><br /><br />public static bool HasValidationIssues&lt;T&gt;(this T validatedResult)<br />    where T : IValidatedResult&lt;T&gt;<br />{<br />    if (validatedResult != null &amp;&amp;<br />        validatedResult.ValidationIssues != null &amp;&amp;<br />        validatedResult.ValidationIssues.Count > 0)<br />        return true;<br />    else<br />        return false;<br />}<br /><br /><br />Don't know if i've very heard anyone talk about one partial class containg some property or common method and being able to create another partial class that defines the interface contract for that... Pretty cool...<br /><script type="text/javascript"><br />var pageTracker = _gat._getTracker("UA-1017448-3");<br />pageTracker._trackPageview();<br /></script></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Interesting observation. Thanks for sharing.<BR/><BR/>I haven't pushed it very far (bool, string, MyCustomObject, etc)</div>
</div>
<div class='comment'>
<div class='author'>Boris Modylevsky</div>
<div class='content'>
Thanks for the post. It's really exciting to receive a proxy of Generic class. It really works smoothly with "simple" classes. But more complex ones result with random names in Silverlight proxy. For example, my <I>SimpleTree&lt;Item&gt;</I> became <I>SimpleTreeNodeOfItemErNMAaNV</I></div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Ok, I quickly threw an example together. I didn't comment much, but the code's there and "works on my box..." <BR/><BR/>Let me know if you have any troubles either understanding it, or getting it working. <BR/><BR/>I've never used this file host service, but giving it a try... I've placed the project here <A HREF="http://www.filesavr.com/validatedresultsample" REL="nofollow"> http://www.filesavr.com/validatedresultsample</A><BR/><BR/>Also the only concepts to really look at here are the ValidatedResult&lt;T&gt; and the notion of the partial classes used along side the VS service reference code to get the extension methods to work... This by no means follows best practices with some of this stuff.<BR/><BR/>Good luck!</div>
</div>
<div class='comment'>
<div class='author'>greg</div>
<div class='content'>
... very much appreciated!!</div>
</div>
<div class='comment'>
<div class='author'>Jason.Jarrett</div>
<div class='content'>
Greg, <BR/><BR/>I will try to put together an example and post it here soon.</div>
</div>
<div class='comment'>
<div class='author'>greg</div>
<div class='content'>
... too many snippets for me to get the big picture... It looks promising, though. Do you have a simple working example you could post? I am interested in the generic proxy concept whether used within Silverlight or otherwise.<BR/>Thanks in advance.</div>
</div>
</div>
